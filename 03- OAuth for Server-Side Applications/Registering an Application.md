## Registering an Application

在你编写任何代码来启动OAuth流程之前，你必须先去授权服务器那里，为你的应用**“注册一个合法的身份”**。这就像你想在一个国家开展业务，你得先去工商部门注册公司，拿到营业执照。

这个注册过程，就是你作为开发者，与授权服务器（如Google, Auth0, Keycloak）的第一次正式“对话”。

### 1. 什么是客户端注册？

- **定义**：在授权服务器上创建一个记录，用来描述和标识你的应用程序（Client）。
- 如何操作：
  - **公共API (如Google, Twitter)**：通常是自助服务。你登录它们的开发者门户网站，填写表单，创建应用。
  - **企业内部服务器 (如公司的Keycloak)**：可能需要联系系统管理员，由他们为你手动创建。
- 注册后得到什么：
  - **客户端ID (Client ID)**：应用的**公开**身份证号。
  - **客户端密钥 (Client Secret)**：应用的**机密**密码（**只有机密客户端才会有！**）。

------

### 2. 注册时需要提供哪些信息？（表单上要填什么？）

每个授权服务器的表单会略有不同，但通常都包含以下核心信息：

1. **应用名称 (Application Name)**：比如“SuperNotes笔记应用”。这个名字会显示在**同意页面 (Consent Screen)**上，告诉用户是哪个应用在请求授权。
2. **应用描述/Logo (Description/Logo)**：同样用于在同意页面上展示，提升用户体验和信任度。
3. **服务条款/隐私政策链接 (Terms of Service/Privacy Policy URL)**：对于公共API，这是建立用户信任的必要信息。
4. 应用类型 (Application Type)：极其重要！服务器会问你：“你正在构建哪种应用？”（如“Web后端应用”、“单页应用”、“移动应用”）。
   - 你选择的类型会直接影响服务器的安全策略。比如，如果你选择“单页应用”，服务器可能：
     - **不给你分配`client_secret`**（因为知道你保管不了）。
     - 自动为你启用CORS头。
     - 强制要求使用PKCE。
5. **重定向URI (Redirect URI(s))**：**这是注册过程中最重要的安全配置！**

------

### 3. 为什么重定向URI如此重要？

- **定义**：一个或多个URL地址的**白名单**。授权服务器在用户授权成功后，**只会**将用户和授权码 (`code`) 发送到这个白名单里的地址。
- 安全目的：防止开放重定向攻击 (Open Redirect Attack)。
  - **如果没有这个白名单**，攻击者可以构造一个链接，用你的`client_id`启动流程，但在请求中偷偷把`redirect_uri`改成他自己的恶意网站。
  - 用户在不知情的情况下在官方页面授权后，浏览器就会带着宝贵的`code`跳转到攻击者的网站，`code`就被盗了。
- 最佳实践：
  - **必须填写**，且越具体越好。
  - **绝对禁止使用通配符 (`\*`)**。比如，`https://*.example.com`是极其危险的，因为它允许重定向到任何子域名，包括可能被攻击者控制的子域名。正确的做法是填写完整的URL，如`https://app.example.com/callback`。
- **对于公共客户端**：正如上节课所说，严格且所有者可控的`redirect_uri`是其**唯一的身份保障**。

------

### 4. 注册后得到的凭证该如何处理？

`client_id`和`client_secret`的区别和正确用法：

- **`Client ID` (公开的身份证号)**
  - 它是**公开信息**。
  - 可以、也必须被包含在源代码中。
  - 它在发起授权流程时放在URL里，用来告诉授权服务器“我是谁”。
- **`Client Secret` (机密的密码)**
  - 它是**绝对机密**，等同于应用的密码。
  - **绝不能**放在任何前端JavaScript代码、移动应用或任何用户可接触到的地方。
  - **只有机密客户端（如后端服务器应用）才能使用它**。
  - 它应该被安全地存放在服务器的环境变量或加密的配置文件中。
  - 它的唯一用途是在**后通道 (Back Channel)\**中，当应用用`code`交换`access_token`时，用来向授权服务器\**证明自己的真实身份**。